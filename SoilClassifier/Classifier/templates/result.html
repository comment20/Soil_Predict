{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'style3.css' %}">



<div class="result-page-container">
    <div class="result-card">
        <h2 class="form-title">Résultats de l'Analyse</h2>

        <div class="image-preview">
            <img src="{{ image_url }}" alt="Image du sol analysé">
        </div>

        <div class="result-info">
            <h3>Type de Sol Détecté</h3>
            <p>{{ predicted_class }}</p>
        </div>

        <div class="probability-section">
            <h3>Probabilité</h3>
            <div class="progress-circle" style="--p:{{ probability_percentage|floatformat:0 }};">
                <div class="progress-value" data-goal="{{ probability_percentage|floatformat:2 }}">0%</div>
            </div>
        </div>

        <div class="form-actions">
            <a href="{% url 'upload_image' %}" class="btn-new-analysis">Nouvelle Analyse</a>
        </div>
    </div>

    <!-- Le nouveau bouton -->
    <a href="{% url 'analyze_characteristics' %}" class="floating-char-btn">Analyse_caracteristique</a>

</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const progressValue = document.querySelector('.progress-value');
    const finalValue = parseFloat(progressValue.getAttribute('data-goal'));
    const animationDuration = 1500; // in milliseconds

    let startTime = null;

    function animateCounter(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = timestamp - startTime;
        const percentage = Math.min(progress / animationDuration, 1);
        const currentValue = percentage * finalValue;

        progressValue.textContent = currentValue.toFixed(2) + '%';

        if (progress < animationDuration) {
            requestAnimationFrame(animateCounter);
        } else {
            progressValue.textContent = finalValue.toFixed(2) + '%';
        }
    }

    requestAnimationFrame(animateCounter);
});
</script>

{% endblock %}
